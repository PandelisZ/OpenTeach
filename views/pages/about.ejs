<!-- views/pages/about.ejs -->

<!DOCTYPE html>
<html lang="en">
<head>
    <% include ../partials/head %>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="http://maps.googleapis.com/maps/api/js"></script>
    <script>
function initialize() {
  var mapProp = {
    center:new google.maps.LatLng(52.48624,	-1.89040),
    zoom:10,
    mapTypeId:google.maps.MapTypeId.ROADMAP
  };
  var map=new google.maps.Map(document.getElementById("googleMap"), mapProp);

  /*var marker=new google.maps.Marker({
    position:myCenter,
    });

  marker.setMap(map);*/

  map.addListener('bounds_changed', function(e) {

    var ne = map.getBounds().getNorthEast();
    var sw = map.getBounds().getSouthWest();
    var latmin = sw.lat();
    var latmax = ne.lat();
    var lngmin = sw.lng();
    var lngmax = ne.lng();

    $.post('/points', {
      latmin: latmin,
      latmax: latmax,
      lngmin: lngmin,
      lngmax: lngmax
    }, function(data) {
      data.forEach(function(point) {
        var marker = new google.maps.Marker({
          position: { lat: Number(point.lat), lng: Number(point.lng) },
          map: map,
          title: (point.firstname + ' ' + point.lastname)
        });
      });
    });
  });
}

google.maps.event.addDomListener(window, 'load', initialize);
</script>
</head>
<body class="container">

    <header>
        <% include ../partials/header %>
    </header>

    <main>
        <div class="row">
            <div class="col-sm-8">

                <div class="jumbotron">
                    <h1>This is great</h1>
                    <p>Welcome to templating using EJS</p>

                    <div id="googleMap" style="width:500px;height:380px;"></div>


                </div>

            </div>
            <div class="col-sm-4">

                <div class="well">
                    <h3>Look I'm A Sidebar!</h3>
                </div>

            </div>
        </div>
    </main>

    <footer>
        <% include ../partials/footer %>
    </footer>
</body>
</html>
